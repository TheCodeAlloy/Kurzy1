<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>V√°≈° QR k√≥d pro check-in</title>
  <!-- QR Code gener√°tor -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .container {
      background: white;
      padding: 40px;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      text-align: center;
      max-width: 500px;
      width: 100%;
    }

    h1 {
      color: #667eea;
      margin-bottom: 10px;
      font-size: 1.8em;
    }

    .subtitle {
      color: #666;
      margin-bottom: 30px;
      font-size: 0.95em;
    }

    .info-section {
      background: #f9f9f9;
      padding: 20px;
      border-radius: 10px;
      margin: 20px 0;
      border-left: 4px solid #667eea;
    }

    .info-section p {
      margin: 10px 0;
      color: #333;
      text-align: left;
    }

    .info-section strong {
      color: #667eea;
    }

    #qrCode {
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 30px 0;
      min-height: 300px;
    }

    .registration-id {
      background: #e7f3ff;
      padding: 15px;
      border-radius: 10px;
      margin: 20px 0;
      border: 2px dashed #2196F3;
    }

    .registration-id strong {
      color: #667eea;
      font-size: 1.1em;
    }

    .tip {
      background: #fff3cd;
      padding: 15px;
      border-radius: 10px;
      border-left: 4px solid #ffc107;
      margin: 20px 0;
      text-align: left;
    }

    .tip p {
      margin: 5px 0;
      color: #666;
      font-size: 0.9em;
    }

    .loading {
      color: #667eea;
      font-size: 1.2em;
      margin: 20px 0;
    }

    .error {
      background: #f8d7da;
      color: #721c24;
      padding: 20px;
      border-radius: 10px;
      border: 2px solid #f5c6cb;
      margin: 20px 0;
    }

    @media (max-width: 768px) {
      .container {
        padding: 20px;
      }

      h1 {
        font-size: 1.5em;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üé´ V√°≈° QR k√≥d pro check-in</h1>
    <p class="subtitle">Uka≈æte tento QR k√≥d p≈ôi p≈ô√≠chodu na kurz</p>

    <div id="loading" class="loading">
      Naƒç√≠t√°m QR k√≥d...
    </div>

    <div id="content" style="display: none;">
      <!-- QR k√≥d se zobraz√≠ zde -->
      <div id="qrCode"></div>

      <!-- Info o p≈ôihl√°≈°ce -->
      <div class="info-section" id="infoSection"></div>

      <!-- ID p≈ôihl√°≈°ky -->
      <div class="registration-id">
        <p><strong>ID p≈ôihl√°≈°ky:</strong></p>
        <p id="registrationIdDisplay" style="font-family: monospace; font-size: 1.1em; color: #333; margin-top: 5px;"></p>
      </div>

      <!-- Tip -->
      <div class="tip">
        <p><strong>üí° Tip:</strong></p>
        <p>Ulo≈æte si tento odkaz do z√°lo≈æek pro rychl√Ω p≈ô√≠stup p≈ôed kurzem.</p>
      </div>
    </div>

    <div id="error" class="error" style="display: none;">
      <h3>‚ùå Chyba</h3>
      <p id="errorMessage"></p>
    </div>
  </div>

  <script>
    // ‚öôÔ∏è KONFIGURACE - ZMƒö≈áTE NA VA≈†I APPS SCRIPT URL
    const API_URL = 'https://script.google.com/macros/s/AKfycbzqcrHf-BnWBBwlitO041mMosOTHj5oF_0wJCy2xfzSzDRrOYlHJJOJL-h27nVKTotxNQ/exec';

    // Z√≠sk√°n√≠ ID p≈ôihl√°≈°ky z URL parametru
    const urlParams = new URLSearchParams(window.location.search);
    const registrationId = urlParams.get('id');

    if (!registrationId) {
      showError('Neplatn√Ω odkaz. Chyb√≠ ID p≈ôihl√°≈°ky v URL.');
    } else {
      loadQRCode();
    }

    async function loadQRCode() {
      try {
        // Vol√°n√≠ API pro z√≠sk√°n√≠ info o p≈ôihl√°≈°ce
        const response = await fetch(API_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            action: 'getRegistrationInfo',
            registrationId: registrationId
          })
        });

        if (!response.ok) {
          throw new Error('Chyba p≈ôi naƒç√≠t√°n√≠ dat');
        }

        const data = await response.json();

        if (data.success) {
          displayQRCode(data);
        } else {
          showError(data.message || 'Nepoda≈ôilo se naƒç√≠st informace o p≈ôihl√°≈°ce');
        }
      } catch (error) {
        console.error('Error:', error);
        showError('Chyba p≈ôipojen√≠ k serveru: ' + error.message);
      }
    }

    function displayQRCode(data) {
      // Skr√Ωt loading
      document.getElementById('loading').style.display = 'none';
      
      // Zobrazit obsah
      document.getElementById('content').style.display = 'block';

      // Vygenerovat QR k√≥d
      new QRCode(document.getElementById("qrCode"), {
        text: data.registrationId,
        width: 300,
        height: 300,
        colorDark: "#000000",
        colorLight: "#ffffff",
        correctLevel: QRCode.CorrectLevel.H
      });

      // Zobrazit ID
      document.getElementById('registrationIdDisplay').textContent = data.registrationId;

      // Zobrazit info
      document.getElementById('infoSection').innerHTML = `
        <p><strong>Jm√©no:</strong> ${data.participant.jmeno} ${data.participant.prijmeni}</p>
        <p><strong>Kurz:</strong> ${data.course.nazev}</p>
        <p><strong>Datum:</strong> ${data.course.datum}</p>
        <p><strong>ƒåas:</strong> ${data.course.hodiny}</p>
        <p><strong>M√≠sto:</strong> ${data.course.misto}</p>
      `;
    }

    function showError(message) {
      document.getElementById('loading').style.display = 'none';
      document.getElementById('error').style.display = 'block';
      document.getElementById('errorMessage').textContent = message;
    }
  </script>
</body>
</html>
